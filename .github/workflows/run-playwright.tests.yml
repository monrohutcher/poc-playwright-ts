name: Run Playwright Tests

on:
  workflow_dispatch:
    inputs:
      feature:
        description: 'Features to be tested. e.g. footer,header'
        required: false
        default: ""
        type: string
      suite:
        description: 'Test suite to be used. e.g. regression/smoke'
        required: true
        type: choice
        default: "smoke"
        options:
           - smoke
           - regression

jobs:
  setup:
    name: Setup
    timeout-minutes: 20
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-node@v4
      with:
        node-version: lts/*

    - name: Install Node Packages
      run: |
        npm cache clean --force
        npm i
        npm list --depth=0 --silent

    - name: Install Playwright Browsers
      run: npx playwright install --with-deps
    
    - name: Display inputs
      run: | 
        echo "Feature: ${{ inputs.feature }}"
        echo "Test suite: ${{ inputs.suite }}"
    
    - name: Run Playwright tests
      run: npx playwright test tests/${{ inputs.feature }} --grep ${{ inputs.suite }}

    - uses: actions/upload-artifact@v4
      if: ${{ !cancelled() }}
      with:
        name: playwright-report
        path: playwright-report/
        retention-days: 5
